ifndef VLHOME
$(error You must set the environment variable VLHOME to the VRLINK installation directory.)
endif

SYNCH_VRLINK_INTERFACE_DIS_DSO_NAME = synch_vrlink_interface-dis.so
SYNCH_VRLINK_INTERFACE_HLA13_DSO_NAME = synch_vrlink_interface-hla13.so
SYNCH_VRLINK_INTERFACE_HLA1516_DSO_NAME = synch_vrlink_interface-hla1516.so

# Do we use 64 or 32 bit libraries?
ifeq ($(findstring 64,$(ARCH)),64)
VRLINK_LIB_DIR = $(VLHOME)/lib64
else
VRLINK_LIB_DIR = $(VLHOME)/lib
endif

SYNCH_VRLINK_INTERFACE_LIBRARIES = -lvl -lmtl -lmatrix -lvlutil

#
# DIS section
#
SYNCH_VRLINK_INTERFACE_DIS_DSO_OBJS = \
    $(SYNCH_VRLINK_INTERFACE_SRC_DIR)/vrlink_shared.o-dis-synch-$(ARCH)-$(COMPILER) \
    $(SYNCH_VRLINK_INTERFACE_SRC_DIR)/vrlink_main.o-dis-synch-$(ARCH)-$(COMPILER) \
    $(SYNCH_VRLINK_INTERFACE_SRC_DIR)/vrlink_dis.o-dis-synch-$(ARCH)-$(COMPILER)

#LDFLAGS += -rdynamic

SYNCH_VRLINK_INTERFACE_DIS_INCLUDES = \
    $(SYNCH_VRLINK_INTERFACE_INCLUDES) -I$(VLHOME)/include

SYNCH_VRLINK_INTERFACE_DIS_LIBRARIES = \
    -L $(VRLINK_LIB_DIR) $(SYNCH_VRLINK_INTERFACE_LIBRARIES) -lvlDIS

../bin/$(SYNCH_VRLINK_INTERFACE_DIS_DSO_NAME): $(SYNCH_VRLINK_INTERFACE_DIS_DSO_OBJS)
	$(CXX) -shared -Wl,-soname,$@ -o $@ $(DEBUG) $(OPT) $^ $(LIBRARIES_LIB) $(SYNCH_VRLINK_INTERFACE_DIS_LIBRARIES)

%.o-dis-synch-$(ARCH)-$(COMPILER): %.cpp
	$(CXX) $(SYNCH_CXXFLAGS) $(SYNCH_VRLINK_INTERFACE_DIS_INCLUDES) -fPIC -DDtDIS -o $@ -c $<

include ../interfaces/vrlink/Makefile-unix-rti

#
# HLA 13 section
#
SYNCH_VRLINK_INTERFACE_HLA13_DSO_OBJS = \
    $(SYNCH_VRLINK_INTERFACE_SRC_DIR)/vrlink_shared.o-hla13-synch-$(ARCH)-$(COMPILER) \
    $(SYNCH_VRLINK_INTERFACE_SRC_DIR)/vrlink_main.o-hla13-synch-$(ARCH)-$(COMPILER) \
    $(SYNCH_VRLINK_INTERFACE_SRC_DIR)/vrlink_hla.o-hla13-synch-$(ARCH)-$(COMPILER)

SYNCH_VRLINK_INTERFACE_HLA13_INCLUDES = \
    $(SYNCH_VRLINK_INTERFACE_INCLUDES) -I$(VLHOME)/include -I$(RTI_HLA13_INCLUDE)

SYNCH_VRLINK_INTERFACE_HLA13_LIBRARIES = \
    -L $(VRLINK_LIB_DIR) $(SYNCH_VRLINK_INTERFACE_LIBRARIES) -lvlHLA13 \
    -L "$(RTI_LIB_DIR)" $(RTI_HLA13_LIBRARY)

../bin/$(SYNCH_VRLINK_INTERFACE_HLA13_DSO_NAME): $(SYNCH_VRLINK_INTERFACE_HLA13_DSO_OBJS)
	$(CXX) -shared -Wl,-soname,$@ -o $@ $(DEBUG) $(OPT) $^ $(LIBRARIES_LIB) $(SYNCH_VRLINK_INTERFACE_HLA13_LIBRARIES)

%.o-hla13-synch-$(ARCH)-$(COMPILER): %.cpp
	$(CXX) $(SYNCH_CXXFLAGS) $(SYNCH_VRLINK_INTERFACE_HLA13_INCLUDES) -fPIC -DDtHLA -DDtHLA13 $(RTI_DEFINES) -o $@ -c $<

#
# HLA 1516 section
#
SYNCH_VRLINK_INTERFACE_HLA1516_DSO_OBJS = \
    $(SYNCH_VRLINK_INTERFACE_SRC_DIR)/vrlink_shared.o-hla1516-synch-$(ARCH)-$(COMPILER) \
    $(SYNCH_VRLINK_INTERFACE_SRC_DIR)/vrlink_main.o-hla1516-synch-$(ARCH)-$(COMPILER) \
    $(SYNCH_VRLINK_INTERFACE_SRC_DIR)/vrlink_hla.o-hla1516-synch-$(ARCH)-$(COMPILER)

SYNCH_VRLINK_INTERFACE_HLA1516_INCLUDES = \
    $(SYNCH_VRLINK_INTERFACE_INCLUDES) -I$(VLHOME)/include -I$(RTI_HLA1516_INCLUDE)

SYNCH_VRLINK_INTERFACE_HLA1516_LIBRARIES = \
    -L $(VRLINK_LIB_DIR) $(SYNCH_VRLINK_INTERFACE_LIBRARIES) -lvlHLA1516 \
    -L "$(RTI_LIB_DIR)" $(RTI_HLA1516_LIBRARY)

../bin/$(SYNCH_VRLINK_INTERFACE_HLA1516_DSO_NAME): $(SYNCH_VRLINK_INTERFACE_HLA1516_DSO_OBJS)
	$(CXX) -shared -Wl,-soname,$@ -o $@ $(DEBUG) $(OPT) $^ $(LIBRARIES_LIB) $(SYNCH_VRLINK_INTERFACE_HLA1516_LIBRARIES)

%.o-hla1516-synch-$(ARCH)-$(COMPILER): %.cpp
	$(CXX) $(SYNCH_CXXFLAGS) $(SYNCH_VRLINK_INTERFACE_HLA1516_INCLUDES) -fPIC -DDtHLA -DDtHLA_1516 $(RTI_DEFINES) -o $@ -c $<

#
# Targets
#

SYNCH_VRLINK_INTERFACE_SHARED_OBJECTS = \
    ../bin/$(SYNCH_VRLINK_INTERFACE_DIS_DSO_NAME) \
    ../bin/$(SYNCH_VRLINK_INTERFACE_HLA13_DSO_NAME) \
    ../bin/$(SYNCH_VRLINK_INTERFACE_HLA1516_DSO_NAME)


ADDON_DEPS      += $(SYNCH_VRLINK_INTERFACE_SHARED_OBJECTS)

clean-vrlink-synch-all:
	rm -f $(SYNCH_VRLINK_INTERFACE_DIS_DSO_OBJS)
	rm -f $(SYNCH_VRLINK_INTERFACE_HLA13_DSO_OBJS)
	rm -f $(SYNCH_VRLINK_INTERFACE_HLA1516_DSO_OBJS)
	rm -f $(SYNCH_VRLINK_INTERFACE_SHARED_OBJECTS)


ADDONS_CLEAN += clean-vrlink-synch-all

vrlink-synch-dsos: $(SYNCH_VRLINK_INTERFACE_SHARED_OBJECTS)

store-vrlink-synch-dsos: vrlink-synch-dsos
	cp ../bin/$(SYNCH_VRLINK_INTERFACE_DIS_DSO_NAME) ../lib/$(ARCH)/vrlink/$(SYNCH_VRLINK_INTERFACE_DIS_DSO_NAME)
	cp ../bin/$(SYNCH_VRLINK_INTERFACE_HLA13_DSO_NAME) ../lib/$(ARCH)/vrlink/$(SYNCH_VRLINK_INTERFACE_HLA13_DSO_NAME)
	cp ../bin/$(SYNCH_VRLINK_INTERFACE_HLA1516_DSO_NAME) ../lib/$(ARCH)/vrlink/$(SYNCH_VRLINK_INTERFACE_HLA1516_DSO_NAME)

build-and-store-vrlink-synch-dsos: vrlink-synch-dsos store-vrlink-synch-dsos
