ifndef VLHOME
$(error You must set the environment variable VLHOME to the VRLINK installation directory.)
endif

TESTFED_VRLINK_INTERFACE_DIS_DSO_NAME = testfed_vrlink_interface-dis.so
TESTFED_VRLINK_INTERFACE_HLA13_DSO_NAME = testfed_vrlink_interface-hla13.so
TESTFED_VRLINK_INTERFACE_HLA1516_DSO_NAME = testfed_vrlink_interface-hla1516.so

# Do we use 64 or 32 bit libraries?
ifeq ($(findstring 64,$(ARCH)),64)
VRLINK_LIB_DIR = $(VLHOME)/lib64
else
VRLINK_LIB_DIR = $(VLHOME)/lib
endif

TESTFED_VRLINK_INTERFACE_LIBRARIES = -lvl -lmtl -lmatrix -lvlutil

#
# DIS section
#
TESTFED_VRLINK_INTERFACE_DIS_DSO_OBJS = \
    $(TESTFED_VRLINK_INTERFACE_SRC_DIR)/vrlink_shared.o-dis-testfed-$(ARCH)-$(COMPILER) \
    $(TESTFED_VRLINK_INTERFACE_SRC_DIR)/vrlink_main.o-dis-testfed-$(ARCH)-$(COMPILER) \
    $(TESTFED_VRLINK_INTERFACE_SRC_DIR)/vrlink_dis.o-dis-testfed-$(ARCH)-$(COMPILER)

#LDFLAGS += -rdynamic

TESTFED_VRLINK_INTERFACE_DIS_INCLUDES = \
    $(TESTFED_VRLINK_INTERFACE_INCLUDES) -I$(VLHOME)/include

TESTFED_VRLINK_INTERFACE_DIS_LIBRARIES = \
    -L $(VRLINK_LIB_DIR) $(TESTFED_VRLINK_INTERFACE_LIBRARIES) -lvlDIS

../bin/$(TESTFED_VRLINK_INTERFACE_DIS_DSO_NAME): $(TESTFED_VRLINK_INTERFACE_DIS_DSO_OBJS)
	$(CXX) -shared -Wl,-soname,$@ -o $@ $(DEBUG) $(OPT) $^ $(LIBRARIES_LIB) $(TESTFED_VRLINK_INTERFACE_DIS_LIBRARIES)

%.o-dis-testfed-$(ARCH)-$(COMPILER): %.cpp
	$(CXX) $(TESTFED_CXXFLAGS) $(TESTFED_VRLINK_INTERFACE_DIS_INCLUDES) -fPIC -DDtDIS -o $@ -c $<

include ../interfaces/vrlink/Makefile-unix-rti

#
# HLA 13 section
#
TESTFED_VRLINK_INTERFACE_HLA13_DSO_OBJS = \
    $(TESTFED_VRLINK_INTERFACE_SRC_DIR)/vrlink_shared.o-hla13-testfed-$(ARCH)-$(COMPILER) \
    $(TESTFED_VRLINK_INTERFACE_SRC_DIR)/vrlink_main.o-hla13-testfed-$(ARCH)-$(COMPILER) \
    $(TESTFED_VRLINK_INTERFACE_SRC_DIR)/vrlink_hla.o-hla13-testfed-$(ARCH)-$(COMPILER)

TESTFED_VRLINK_INTERFACE_HLA13_INCLUDES = \
    $(TESTFED_VRLINK_INTERFACE_INCLUDES) -I$(VLHOME)/include -I$(RTI_HLA13_INCLUDE)

TESTFED_VRLINK_INTERFACE_HLA13_LIBRARIES = \
    -L $(VRLINK_LIB_DIR) $(TESTFED_VRLINK_INTERFACE_LIBRARIES) -lvlHLA13 \
    -L "$(RTI_LIB_DIR)" $(RTI_HLA13_LIBRARY)

../bin/$(TESTFED_VRLINK_INTERFACE_HLA13_DSO_NAME): $(TESTFED_VRLINK_INTERFACE_HLA13_DSO_OBJS)
	$(CXX) -shared -Wl,-soname,$@ -o $@ $(DEBUG) $(OPT) $^ $(LIBRARIES_LIB) $(TESTFED_VRLINK_INTERFACE_HLA13_LIBRARIES)

%.o-hla13-testfed-$(ARCH)-$(COMPILER): %.cpp
	$(CXX) $(TESTFED_CXXFLAGS) $(TESTFED_VRLINK_INTERFACE_HLA13_INCLUDES) -fPIC -DDtHLA -DDtHLA13 $(RTI_DEFINES) -o $@ -c $<

#
# HLA 1516 section
#
TESTFED_VRLINK_INTERFACE_HLA1516_DSO_OBJS = \
    $(TESTFED_VRLINK_INTERFACE_SRC_DIR)/vrlink_shared.o-hla1516-testfed-$(ARCH)-$(COMPILER) \
    $(TESTFED_VRLINK_INTERFACE_SRC_DIR)/vrlink_main.o-hla1516-testfed-$(ARCH)-$(COMPILER) \
    $(TESTFED_VRLINK_INTERFACE_SRC_DIR)/vrlink_hla.o-hla1516-testfed-$(ARCH)-$(COMPILER)

TESTFED_VRLINK_INTERFACE_HLA1516_INCLUDES = \
    $(TESTFED_VRLINK_INTERFACE_INCLUDES) -I$(VLHOME)/include -I$(RTI_HLA1516_INCLUDE)

TESTFED_VRLINK_INTERFACE_HLA1516_LIBRARIES = \
    -L $(VRLINK_LIB_DIR) $(TESTFED_VRLINK_INTERFACE_LIBRARIES) -lvlHLA1516 \
    -L "$(RTI_LIB_DIR)" $(RTI_HLA1516_LIBRARY)

../bin/$(TESTFED_VRLINK_INTERFACE_HLA1516_DSO_NAME): $(TESTFED_VRLINK_INTERFACE_HLA1516_DSO_OBJS)
	$(CXX) -shared -Wl,-soname,$@ -o $@ $(DEBUG) $(OPT) $^ $(LIBRARIES_LIB) $(TESTFED_VRLINK_INTERFACE_HLA1516_LIBRARIES)

%.o-hla1516-testfed-$(ARCH)-$(COMPILER): %.cpp
	$(CXX) $(TESTFED_CXXFLAGS) $(TESTFED_VRLINK_INTERFACE_HLA1516_INCLUDES) -fPIC -DDtHLA -DDtHLA_1516 $(RTI_DEFINES) -o $@ -c $<

#
# Targets
#

TESTFED_VRLINK_INTERFACE_SHARED_OBJECTS = \
    ../bin/$(TESTFED_VRLINK_INTERFACE_DIS_DSO_NAME) \
    ../bin/$(TESTFED_VRLINK_INTERFACE_HLA13_DSO_NAME) \
    ../bin/$(TESTFED_VRLINK_INTERFACE_HLA1516_DSO_NAME)

ADDON_DEPS      += $(TESTFED_VRLINK_INTERFACE_SHARED_OBJECTS)

clean-vrlink-testfed-all:
	rm -f $(TESTFED_VRLINK_INTERFACE_DIS_DSO_OBJS)
	rm -f $(TESTFED_VRLINK_INTERFACE_HLA13_DSO_OBJS)
	rm -f $(TESTFED_VRLINK_INTERFACE_HLA1516_DSO_OBJS)
	rm -f $(TESTFED_VRLINK_INTERFACE_SHARED_OBJECTS)


ADDONS_CLEAN += clean-vrlink-testfed-all

vrlink-testfed-dsos: $(TESTFED_VRLINK_INTERFACE_SHARED_OBJECTS)

store-vrlink-testfed-dsos: vrlink-testfed-dsos
	cp ../bin/$(TESTFED_VRLINK_INTERFACE_DIS_DSO_NAME) ../lib/$(ARCH)/vrlink/$(TESTFED_VRLINK_INTERFACE_DIS_DSO_NAME)
	cp ../bin/$(TESTFED_VRLINK_INTERFACE_HLA13_DSO_NAME) ../lib/$(ARCH)/vrlink/$(TESTFED_VRLINK_INTERFACE_HLA13_DSO_NAME)
	cp ../bin/$(TESTFED_VRLINK_INTERFACE_HLA1516_DSO_NAME) ../lib/$(ARCH)/vrlink/$(TESTFED_VRLINK_INTERFACE_HLA1516_DSO_NAME)

build-and-store-vrlink-testfed-dsos: vrlink-testfed-dsos store-vrlink-testfed-dsos